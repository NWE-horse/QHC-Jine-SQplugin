<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>青花瓷~瓷~瓷~瓷~瓷~~~</title>
<style>
    body {
        font-family: 'Arial', sans-serif;
        margin: 0;
        padding: 0;
        background-color: #f5f5f5;
    }
    #container {
        max-width: 600px;
        margin: 20px auto;
        padding: 20px;
        background-color: #fff;
        border-radius: 8px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }
    h1 {
        text-align: center;
        color: #333;
    }
    textarea {
    width: 100%;
    height: 500px; /* 固定高度为500px */
    padding: 12px;
    margin-top: 8px;
    margin-bottom: 20px;
    border: 1px solid #ccc;
    border-radius: 4px;
    box-sizing: border-box;
    resize: none; /* 禁止拉伸 */
}

input[type="text"] {
    width: 100%;
    padding: 12px;
    margin-top: 8px;
    margin-bottom: 20px;
    border: 1px solid #ccc;
    border-radius: 4px;
    box-sizing: border-box;
}
    textarea:focus, input[type="text"]:focus {
        border-color: #007bff;
    }
    .red-text {
        color: red;
        font-size: 12px;
    }
    button {
        display: block;
        width: 100%;
        padding: 12px;
        background-color: #007bff;
        color: #fff;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        transition: background-color 0.3s;
    }
    button:hover {
        background-color: #0056b3;
    }

</style>
</head>
<body>
    <div id="container">
        <h1>青花瓷四服联BAN系统</h1>
        <textarea id="fileContent" rows="10" cols="50" disabled></textarea>
        <input type="text" id="textInput" placeholder="例如：76561199383615142:0 //金铲铲，处理人:Wander">
        <p class="red-text">注：正确格式是 64ID+天数+ //备注+处理人</p>
        <p class="red-text">注2：//的前面有一个空格 3d是3天，3m是3月，3y是3年，0是永久</p>
        <button onclick="appendAndSave()">提交</button>
    </div>

    <script>
        const time = new Date().toLocaleString();
        const fileContent = document.getElementById('fileContent');
        const textInput = document.getElementById('textInput');

        // 加载文件内容
        async function loadFile() {
            try {
                const response = await fetch('/static/bans.cfg');
                const content = await response.text();
                fileContent.value = content;
            } catch (error) {
                console.error('加载文件错误:', error);
            }
        }

        // 追加并保存文件内容
        async function appendAndSave() {
            try {
                let content = fileContent.value;
                const additionalContent = textInput.value.trim();
                if (!isValidFormat(additionalContent)) {
                    alert('格式错误，请按照正确的格式提交');
                    return;
                }
                if (additionalContent) {
                    // 追加输入框中的内容到文件内容末尾
                    content += '\n' + additionalContent+' '+time;
                    fileContent.value = content; // 更新文本区域中的内容
                    textInput.value = ''; // 清空输入框内容
                }

                const response = await fetch('/save', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ content })
                });
                if (response.ok) {
                    console.log('文件保存成功');
                    // 保存成功后重新加载文件内容
                    loadFile();
                } else {
                    console.error('保存文件失败');
                }
            } catch (error) {
                console.error('保存文件错误:', error);
            }
        }

        // 检查输入格式是否合法
        function isValidFormat(input) {
            const regex = /(\d{17}):(\d) \/\/(.*) 处理人(.*)/;
            return regex.test(input);
        }

        // 页面加载时调用加载文件内容函数
        window.onload = loadFile;
    </script>
</body>
</html>
